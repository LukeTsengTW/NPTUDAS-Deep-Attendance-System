<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç³»çµ±è¨­å®š - AIé»åç³»çµ±</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Microsoft JhengHei', Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        .header {
            background: white;
            border-radius: 15px;
            padding: 20px 30px;
            margin-bottom: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .header h1 {
            color: #667eea;
            font-size: 2em;
        }

        .header .actions {
            display: flex;
            gap: 10px;
        }

        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            text-decoration: none;
            display: inline-block;
            color: white;
        }

        .btn-primary {
            background: #667eea;
        }

        .btn-primary:hover {
            background: #5568d3;
            transform: translateY(-2px);
        }

        .btn-secondary {
            background: #6c757d;
        }

        .btn-secondary:hover {
            background: #5a6268;
        }

        .btn-success {
            background: #28a745;
        }

        .btn-success:hover {
            background: #218838;
        }

        .btn-danger {
            background: #dc3545;
        }

        .btn-danger:hover {
            background: #c82333;
        }

        .btn-warning {
            background: #ffc107;
            color: #333;
        }

        .btn-warning:hover {
            background: #e0a800;
        }

        .card {
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            margin-bottom: 20px;
            animation: fadeIn 0.5s ease;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .card h2 {
            color: #667eea;
            margin-bottom: 20px;
            font-size: 1.5em;
            padding-bottom: 15px;
            border-bottom: 2px solid #eee;
        }

        .form-section {
            margin-bottom: 30px;
        }

        .form-section:last-child {
            margin-bottom: 0;
        }

        .form-section h3 {
            color: #333;
            margin-bottom: 15px;
            font-size: 1.2em;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            color: #333;
            font-weight: bold;
        }

        .form-group .help-text {
            font-size: 0.9em;
            color: #666;
            margin-top: 5px;
        }

        .form-group input,
        .form-group select {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 14px;
            transition: all 0.3s;
        }

        .form-group input:focus,
        .form-group select:focus {
            outline: none;
            border-color: #667eea;
        }

        .form-group input[type="range"] {
            padding: 0;
        }

        .range-value {
            display: inline-block;
            margin-left: 10px;
            font-weight: bold;
            color: #667eea;
            min-width: 50px;
        }

        .checkbox-group {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .checkbox-group input[type="checkbox"] {
            width: auto;
            cursor: pointer;
        }

        .button-group {
            display: flex;
            gap: 15px;
            margin-top: 30px;
            padding-top: 20px;
            border-top: 2px solid #eee;
        }

        .message {
            padding: 12px;
            border-radius: 8px;
            margin-bottom: 20px;
            display: none;
            animation: slideIn 0.3s ease;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateX(-20px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        .message.success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .message.error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        .message.warning {
            background: #fff3cd;
            color: #856404;
            border: 1px solid #ffeaa7;
        }

        .warning-box {
            background: #fff3cd;
            border: 2px solid #ffc107;
            border-radius: 10px;
            padding: 15px;
            margin: 20px 0;
        }

        .warning-box h4 {
            color: #856404;
            margin-bottom: 10px;
        }

        .warning-box ul {
            margin-left: 20px;
            color: #856404;
        }

        .info-box {
            background: #d1ecf1;
            border: 2px solid #17a2b8;
            border-radius: 10px;
            padding: 15px;
            margin: 20px 0;
        }

        .info-box h4 {
            color: #0c5460;
            margin-bottom: 10px;
        }

        .info-box p {
            color: #0c5460;
            margin: 5px 0;
        }

        /* Toast é€šçŸ¥æ¨£å¼ */
        .toast-container {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 9999;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .toast {
            min-width: 300px;
            padding: 16px 20px;
            background: white;
            border-radius: 12px;
            box-shadow: 0 8px 24px rgba(0,0,0,0.2);
            display: flex;
            align-items: center;
            gap: 12px;
            animation: slideIn 0.4s cubic-bezier(0.68, -0.55, 0.265, 1.55);
            position: relative;
            overflow: hidden;
        }

        .toast.success {
            border-left: 4px solid #28a745;
        }

        .toast.error {
            border-left: 4px solid #dc3545;
        }

        .toast.info {
            border-left: 4px solid #17a2b8;
        }

        .toast.warning {
            border-left: 4px solid #ffc107;
        }

        .toast-icon {
            font-size: 24px;
            flex-shrink: 0;
        }

        .toast.success .toast-icon {
            color: #28a745;
        }

        .toast.error .toast-icon {
            color: #dc3545;
        }

        .toast.info .toast-icon {
            color: #17a2b8;
        }

        .toast.warning .toast-icon {
            color: #ffc107;
        }

        .toast-content {
            flex: 1;
        }

        .toast-title {
            font-weight: bold;
            margin-bottom: 4px;
            font-size: 15px;
            color: #333;
        }

        .toast-message {
            font-size: 13px;
            color: #666;
        }

        .toast-progress {
            position: absolute;
            bottom: 0;
            left: 0;
            height: 3px;
            background: linear-gradient(90deg, #667eea, #764ba2);
            animation: progress 3s linear forwards;
        }

        @keyframes slideIn {
            from {
                transform: translateX(400px);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        @keyframes slideOut {
            from {
                transform: translateX(0);
                opacity: 1;
            }
            to {
                transform: translateX(400px);
                opacity: 0;
            }
        }

        @keyframes progress {
            from {
                width: 100%;
            }
            to {
                width: 0%;
            }
        }

        .toast.hiding {
            animation: slideOut 0.4s cubic-bezier(0.68, -0.55, 0.265, 1.55) forwards;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <h1>âš™ï¸ ç³»çµ±è¨­å®š</h1>
            <div class="actions">
                <span style="color: #666; margin-right: 10px;">ğŸ‘¤ {{ username }}</span>
                <a href="/admin_dashboard" class="btn btn-primary">ğŸ”™ è¿”å›å¾Œå°</a>
                <a href="/" class="btn btn-secondary">ğŸ  è¿”å›ä¸»é </a>
            </div>
        </div>

        <div id="message" class="message"></div>

        <!-- Warning Box -->
        <div class="warning-box">
            <h4>âš ï¸ é‡è¦æç¤º</h4>
            <ul>
                <li>ä¿®æ”¹è¨­å®šå¾Œå‹™å¿…å…ˆåœ¨æœ€åº•ä¸‹<strong>æŒ‰ä¸‹å„²å­˜è¨­å®š</strong>ç„¶å¾Œ<strong>é‡æ–°å•Ÿå‹•ç³»çµ±</strong>æ‰èƒ½å®Œå…¨ç”Ÿæ•ˆï¼</li>
                <li>è«‹è¬¹æ…ä¿®æ”¹è­˜åˆ¥åƒæ•¸ï¼Œä¸ç•¶çš„è¨­å®šå¯èƒ½å½±éŸ¿è¾¨è­˜æº–ç¢ºåº¦</li>
                <li>ä¿®æ”¹ç®¡ç†å“¡å¯†ç¢¼å¾Œï¼Œè«‹å¦¥å–„ä¿ç®¡æ–°å¯†ç¢¼</li>
            </ul>
        </div>

        <!-- System Settings -->
        <div class="card">
            <h2>ğŸ¢ ç³»çµ±è³‡è¨Š</h2>
            
            <div class="form-section">
                <div class="form-group">
                    <label for="systemName">ç³»çµ±åç¨±</label>
                    <input type="text" id="systemName" value="{{ config.system.system_name }}">
                    <div class="help-text">é¡¯ç¤ºåœ¨ç³»çµ±æ¨™é¡Œåˆ—çš„åç¨±</div>
                </div>

                <div class="form-group">
                    <label for="version">ç³»çµ±ç‰ˆæœ¬</label>
                    <input type="text" id="version" value="{{ config.system.version }}" readonly style="background: #f5f5f5;">
                    <div class="help-text">ç•¶å‰ç³»çµ±ç‰ˆæœ¬ï¼ˆå”¯è®€ï¼‰</div>
                </div>

                <div class="form-group">
                    <label for="language">ç³»çµ±èªè¨€</label>
                    <select id="language">
                        <option value="zh-TW" {% if config.system.language == 'zh-TW' %}selected{% endif %}>ç¹é«”ä¸­æ–‡</option>
                        <option value="zh-CN" {% if config.system.language == 'zh-CN' %}selected{% endif %}>ç®€ä½“ä¸­æ–‡</option>
                        <option value="en" {% if config.system.language == 'en' %}selected{% endif %}>English</option>
                    </select>
                </div>
            </div>
        </div>

        <!-- Recognition Settings -->
        <div class="card">
            <h2>ğŸ¯ äººè‡‰è¾¨è­˜è¨­å®š</h2>
            
            <div class="form-section">
                <h3>ğŸ“ è¾¨è­˜åƒæ•¸</h3>

                <div class="form-group">
                    <label for="tolerance">
                        Toleranceï¼ˆå®¹å¿åº¦ï¼‰
                        <span class="range-value" id="toleranceValue">{{ config.recognition.tolerance }}</span>
                    </label>
                    <input type="range" id="tolerance" min="0.3" max="0.6" step="0.01" value="{{ config.recognition.tolerance }}" oninput="updateRangeValue('tolerance', this.value)">
                    <div class="help-text">
                        æ•¸å€¼è¶Šå°è¶Šåš´æ ¼ï¼ˆå»ºè­°: 0.40-0.50ï¼‰<br>
                        â€¢ 0.30-0.40: éå¸¸åš´æ ¼ï¼Œæ¸›å°‘èª¤è­˜åˆ¥ä½†å¯èƒ½æ¼è­˜åˆ¥<br>
                        â€¢ 0.40-0.50: é©ä¸­ï¼Œå¹³è¡¡æº–ç¢ºåº¦å’Œè¾¨è­˜ç‡ â­<br>
                        â€¢ 0.50-0.60: å¯¬é¬†ï¼Œæé«˜è¾¨è­˜ç‡ä½†å¯èƒ½èª¤è­˜åˆ¥
                    </div>
                </div>

                <div class="form-group">
                    <label for="displayThreshold">
                        é¡¯ç¤ºä¿¡å¿ƒåº¦é–¾å€¼ï¼ˆ%ï¼‰
                        <span class="range-value" id="displayThresholdValue">{{ config.recognition.display_confidence_threshold }}</span>
                    </label>
                    <input type="range" id="displayThreshold" min="50" max="90" step="1" value="{{ config.recognition.display_confidence_threshold }}" oninput="updateRangeValue('displayThreshold', this.value)">
                    <div class="help-text">é”åˆ°æ­¤ä¿¡å¿ƒåº¦æ‰æœƒåœ¨ç•«é¢ä¸Šé¡¯ç¤ºå§“åï¼ˆå»ºè­°: 60-70%ï¼‰</div>
                </div>

                <div class="form-group">
                    <label for="attendanceThreshold">
                        å‡ºå¸­è¨˜éŒ„é–¾å€¼ï¼ˆ%ï¼‰
                        <span class="range-value" id="attendanceThresholdValue">{{ config.recognition.attendance_confidence_threshold }}</span>
                    </label>
                    <input type="range" id="attendanceThreshold" min="50" max="90" step="1" value="{{ config.recognition.attendance_confidence_threshold }}" oninput="updateRangeValue('attendanceThreshold', this.value)">
                    <div class="help-text">é”åˆ°æ­¤ä¿¡å¿ƒåº¦æ‰æœƒè¨˜éŒ„å‡ºå¸­ï¼ˆå»ºè­°: 65-75%ï¼‰</div>
                </div>

                <div class="form-group">
                    <label for="processFrames">
                        è™•ç†å¹€æ•¸é–“éš”
                        <span class="range-value" id="processFramesValue">{{ config.recognition.process_every_n_frames }}</span>
                    </label>
                    <input type="range" id="processFrames" min="10" max="120" step="10" value="{{ config.recognition.process_every_n_frames }}" oninput="updateRangeValue('processFrames', this.value)">
                    <div class="help-text">
                        æ¯ N å¹€è™•ç†ä¸€æ¬¡äººè‡‰è¾¨è­˜ï¼ˆå½±éŸ¿æ•ˆèƒ½å’Œåæ‡‰é€Ÿåº¦ï¼‰<br>
                        â€¢ 10-30: åæ‡‰å¿«ä½†è€—è³‡æº<br>
                        â€¢ 40-60: å¹³è¡¡æ•ˆèƒ½å’Œåæ‡‰ â­<br>
                        â€¢ 70-120: çœè³‡æºä½†åæ‡‰æ…¢
                    </div>
                </div>
            </div>
        </div>

        <!-- Video Settings -->
        <div class="card">
            <h2>ğŸ“¹ å½±åƒè¨­å®š</h2>
            
            <div class="form-section">
                <div class="form-group">
                    <label for="jpegQuality">
                        JPEG å½±åƒå“è³ªï¼ˆ%ï¼‰
                        <span class="range-value" id="jpegQualityValue">{{ config.video.jpeg_quality }}</span>
                    </label>
                    <input type="range" id="jpegQuality" min="60" max="100" step="5" value="{{ config.video.jpeg_quality }}" oninput="updateRangeValue('jpegQuality', this.value)">
                    <div class="help-text">
                        å½±åƒä¸²æµçš„ JPEG å£“ç¸®å“è³ªï¼ˆå»ºè­°: 80-90%ï¼‰<br>
                        è¼ƒä½çš„å“è³ªå¯æå‡å‚³è¼¸é€Ÿåº¦ï¼Œä½†å½±åƒè¼ƒæ¨¡ç³Š
                    </div>
                </div>

                <div class="form-group">
                    <label for="cameraIndex">é¡é ­ç´¢å¼•</label>
                    <input type="number" id="cameraIndex" min="0" max="9" value="{{ config.video.camera_index }}">
                    <div class="help-text">
                        é¡é ­è¨­å‚™ç·¨è™Ÿï¼ˆ0=é è¨­é¡é ­ï¼Œ1=ç¬¬äºŒå€‹é¡é ­...ï¼‰<br>
                        å¦‚æœè¾¨è­˜ç•«é¢ç„¡æ³•é¡¯ç¤ºï¼Œå¯å˜—è©¦ä¿®æ”¹æ­¤æ•¸å€¼
                    </div>
                </div>
            </div>
        </div>

        <!-- Admin Settings -->
        <div class="card">
            <h2>ğŸ” ç®¡ç†å“¡è¨­å®š</h2>
            
            <div class="warning-box">
                <h4>ğŸ”’ å®‰å…¨æç¤º</h4>
                <ul>
                    <li>ä¿®æ”¹å¸³è™Ÿå¯†ç¢¼å¾Œï¼Œä¸‹æ¬¡ç™»å…¥éœ€ä½¿ç”¨æ–°çš„å¸³è™Ÿå¯†ç¢¼</li>
                    <li>è«‹ä½¿ç”¨å¼·å¯†ç¢¼ï¼ˆè‡³å°‘8ä½ï¼ŒåŒ…å«è‹±æ–‡å’Œæ•¸å­—ï¼‰</li>
                    <li>è«‹å‹¿èˆ‡ä»–äººåˆ†äº«ç®¡ç†å“¡å¯†ç¢¼</li>
                </ul>
            </div>

            <div class="form-section">
                <div class="form-group">
                    <label for="adminUsername">ç®¡ç†å“¡å¸³è™Ÿ</label>
                    <input type="text" id="adminUsername" value="{{ config.admin.username }}">
                    <div class="help-text">ç”¨æ–¼ç™»å…¥å¾Œå°ç®¡ç†ç³»çµ±çš„å¸³è™Ÿ</div>
                </div>

                <div class="form-group">
                    <label for="adminPassword">ç®¡ç†å“¡å¯†ç¢¼</label>
                    <input type="password" id="adminPassword" value="{{ config.admin.password }}">
                    <div class="help-text">ç”¨æ–¼ç™»å…¥å¾Œå°ç®¡ç†ç³»çµ±çš„å¯†ç¢¼</div>
                </div>

                <div class="form-group">
                    <label for="sessionTimeout">
                        Session é€¾æ™‚æ™‚é–“ï¼ˆç§’ï¼‰
                        <span class="range-value" id="sessionTimeoutValue">{{ config.admin.session_timeout }}</span>
                    </label>
                    <input type="range" id="sessionTimeout" min="300" max="86400" step="300" value="{{ config.admin.session_timeout }}" oninput="updateRangeValue('sessionTimeout', this.value)">
                    <div class="help-text">
                        ç™»å…¥å¾Œçš„æœ‰æ•ˆæ™‚é–“ï¼ˆå»ºè­°: 3600ç§’ = 1å°æ™‚ï¼‰<br>
                        è¶…éæ­¤æ™‚é–“æœªæ“ä½œå°‡è‡ªå‹•ç™»å‡º
                    </div>
                </div>
            </div>
        </div>

        <!-- Attendance Settings -->
        <div class="card">
            <h2>ğŸ“ å‡ºå¸­è¨˜éŒ„è¨­å®š</h2>
            
            <div class="form-section">
                <div class="form-group">
                    <div class="checkbox-group">
                        <input type="checkbox" id="autoRecord" {% if config.attendance.auto_record %}checked{% endif %}>
                        <label for="autoRecord" style="margin-bottom: 0;">è‡ªå‹•è¨˜éŒ„å‡ºå¸­</label>
                    </div>
                    <div class="help-text">å•Ÿç”¨å¾Œï¼Œè¾¨è­˜åˆ°å­¸ç”Ÿæ™‚è‡ªå‹•è¨˜éŒ„å‡ºå¸­</div>
                </div>

                <div class="form-group">
                    <label for="recordFormat">è¨˜éŒ„æ ¼å¼</label>
                    <select id="recordFormat">
                        <option value="csv" {% if config.attendance.record_format == 'csv' %}selected{% endif %}>CSV</option>
                        <option value="excel" {% if config.attendance.record_format == 'excel' %}selected{% endif %}>Excel</option>
                        <option value="json" {% if config.attendance.record_format == 'json' %}selected{% endif %}>JSON</option>
                    </select>
                    <div class="help-text">å‡ºå¸­è¨˜éŒ„å„²å­˜çš„æª”æ¡ˆæ ¼å¼ï¼ˆç›®å‰åƒ…æ”¯æ´ CSVï¼‰</div>
                </div>

                <div class="form-group">
                    <div class="checkbox-group">
                        <input type="checkbox" id="backupEnabled" {% if config.attendance.backup_enabled %}checked{% endif %}>
                        <label for="backupEnabled" style="margin-bottom: 0;">å•Ÿç”¨è‡ªå‹•å‚™ä»½</label>
                    </div>
                    <div class="help-text">å®šæœŸå‚™ä»½å‡ºå¸­è¨˜éŒ„ï¼ˆåŠŸèƒ½é–‹ç™¼ä¸­ï¼‰</div>
                </div>
            </div>
        </div>

        <div class="card" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white;">
            <div class="info-note" style="background: rgba(255,255,255,0.15); border-left: 4px solid white; color: white; margin-top: 15px;">
                <strong>ç›®å‰èª²ç¨‹è³‡è¨Šï¼š</strong>
                <br>
                ğŸ“š {{ config.course.course_name if config.course else 'è¨ˆç®—æ©Ÿæ¦‚è«–' }} 
                - ç¬¬ {{ config.course.current_session if config.course else 1 }} ç¯€ï¼ˆå…± {{ config.course.total_sessions if config.course else 3 }} ç¯€ï¼‰
                <br>
                ğŸ‘¨â€ğŸ« {{ config.course.instructor if config.course else 'æ—ç¾©å‡±æ•™æˆ' }}
            </div>
        </div>

        <!-- Current Configuration Info -->
        <div class="info-box">
            <h4>ğŸ“Š ç•¶å‰é…ç½®æ‘˜è¦</h4>
            <p><strong>è¾¨è­˜å®¹å¿åº¦:</strong> {{ config.recognition.tolerance }}</p>
            <p><strong>é¡¯ç¤ºé–¾å€¼:</strong> {{ config.recognition.display_confidence_threshold }}%</p>
            <p><strong>å‡ºå¸­é–¾å€¼:</strong> {{ config.recognition.attendance_confidence_threshold }}%</p>
            <p><strong>è™•ç†é–“éš”:</strong> æ¯ {{ config.recognition.process_every_n_frames }} å¹€</p>
            <p><strong>å½±åƒå“è³ª:</strong> {{ config.video.jpeg_quality }}%</p>
            <p><strong>ç›®å‰èª²ç¨‹:</strong> {{ config.course.course_name if config.course else 'è¨ˆç®—æ©Ÿæ¦‚è«–' }} - ç¬¬ {{ config.course.current_session if config.course else 1 }} ç¯€</p>
        </div>

        <!-- Action Buttons -->
        <div class="card">
            <div class="button-group">
                <button class="btn btn-success" onclick="saveSettings()">
                    ğŸ’¾ å„²å­˜è¨­å®š
                </button>
                <button class="btn btn-warning" onclick="resetSettings()">
                    ğŸ”„ é‡ç½®ç‚ºé è¨­å€¼
                </button>
                <button class="btn btn-secondary" onclick="window.location.href='/admin_dashboard'">
                    âŒ å–æ¶ˆ
                </button>
            </div>
        </div>
    </div>

    <script>
        // é€šç”¨ Toast é€šçŸ¥å‡½æ•¸
        function showToast(title, message, type = 'success', duration = 3000) {
            const container = document.getElementById('toastContainer');
            
            // å‰µå»º toast å…ƒç´ 
            const toast = document.createElement('div');
            toast.className = `toast ${type}`;
            
            // è¨­å®šåœ–æ¨™
            const icons = {
                success: 'âœ“',
                error: 'âœ—',
                info: 'â„¹',
                warning: 'âš '
            };
            
            toast.innerHTML = `
                <div class="toast-icon">${icons[type] || 'âœ“'}</div>
                <div class="toast-content">
                    <div class="toast-title">${title}</div>
                    ${message ? `<div class="toast-message">${message}</div>` : ''}
                </div>
                <div class="toast-progress"></div>
            `;
            
            // æ·»åŠ åˆ°å®¹å™¨
            container.appendChild(toast);
            
            // è‡ªå‹•ç§»é™¤
            setTimeout(() => {
                toast.classList.add('hiding');
                setTimeout(() => {
                    container.removeChild(toast);
                }, 400);
            }, duration);
        }

        function showMessage(text, type) {
            // è§£æè¨Šæ¯ä¸­çš„ emoji å’Œæ–‡å­—
            const titleMap = {
                'success': 'æ“ä½œæˆåŠŸ',
                'error': 'æ“ä½œå¤±æ•—',
                'info': 'æç¤ºè¨Šæ¯',
                'warning': 'è­¦å‘Šè¨Šæ¯'
            };
            
            // ç§»é™¤è¨Šæ¯å‰é¢çš„ emojiï¼ˆâœ… æˆ– âŒï¼‰
            const cleanText = text.replace(/^[âœ…âŒ]\s*/, '');
            
            showToast(titleMap[type] || 'é€šçŸ¥', cleanText, type);
        }

        function updateRangeValue(id, value) {
            document.getElementById(id + 'Value').textContent = value;
        }

        async function saveSettings() {
            try {
                const settings = {
                    system: {
                        system_name: document.getElementById('systemName').value,
                        language: document.getElementById('language').value
                    },
                    recognition: {
                        tolerance: parseFloat(document.getElementById('tolerance').value),
                        display_confidence_threshold: parseInt(document.getElementById('displayThreshold').value),
                        attendance_confidence_threshold: parseInt(document.getElementById('attendanceThreshold').value),
                        process_every_n_frames: parseInt(document.getElementById('processFrames').value)
                    },
                    video: {
                        jpeg_quality: parseInt(document.getElementById('jpegQuality').value),
                        camera_index: parseInt(document.getElementById('cameraIndex').value)
                    },
                    admin: {
                        username: document.getElementById('adminUsername').value,
                        password: document.getElementById('adminPassword').value,
                        session_timeout: parseInt(document.getElementById('sessionTimeout').value)
                    },
                    attendance: {
                        auto_record: document.getElementById('autoRecord').checked,
                        record_format: document.getElementById('recordFormat').value,
                        backup_enabled: document.getElementById('backupEnabled').checked
                    }
                };

                const response = await fetch('/admin_settings/save', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(settings)
                });

                const result = await response.json();

                if (result.success) {
                    showMessage('âœ… ' + result.message, 'success');
                    
                    // 3ç§’å¾Œé‡æ–°è¼‰å…¥é é¢
                    setTimeout(() => {
                        window.location.reload();
                    }, 3000);
                } else {
                    showMessage('âŒ ' + result.message, 'error');
                }

            } catch (error) {
                console.error('Save settings error:', error);
                showMessage('å„²å­˜å¤±æ•—: ' + error.message, 'error');
            }
        }

        async function resetSettings() {
            if (!confirm('ç¢ºå®šè¦é‡ç½®ç‚ºé è¨­è¨­å®šå—ï¼Ÿ\n\né€™å°‡æœƒé‚„åŸæ‰€æœ‰è¨­å®šåˆ°åˆå§‹å€¼ã€‚')) {
                return;
            }

            try {
                const response = await fetch('/admin_settings/reset', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    }
                });

                const result = await response.json();

                if (result.success) {
                    showMessage('âœ… ' + result.message, 'success');
                    
                    // 2ç§’å¾Œé‡æ–°è¼‰å…¥é é¢
                    setTimeout(() => {
                        window.location.reload();
                    }, 2000);
                } else {
                    showMessage('âŒ ' + result.message, 'error');
                }

            } catch (error) {
                console.error('Reset settings error:', error);
                showMessage('é‡ç½®å¤±æ•—: ' + error.message, 'error');
            }
        }
    </script>

    <!-- Toast é€šçŸ¥å®¹å™¨ -->
    <div class="toast-container" id="toastContainer"></div>
</body>
</html>
